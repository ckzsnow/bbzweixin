(function(a){var b=a.className("pull-top-tips");a.PullToRefresh=a.PullToRefresh.extend({init:function(c,d){this._super(c,d);this.options=a.extend(true,{down:{tips:{colors:["008000","d8ad44","d00324","dc00b8","017efc"],size:200,lineWidth:15,duration:1000,tail_duration:1000*2.5}}},this.options);this.options.down.tips.color=this.options.down.tips.colors[0];this.options.down.tips.colors=this.options.down.tips.colors.map(function(e){return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}})},initPullDownTips:function(){var c=this;if(a.isFunction(c.options.down.callback)){c.pullDownTips=(function(){var d=document.querySelector("."+b);if(d){d.parentNode.removeChild(d)}if(!d){d=document.createElement("div");d.classList.add(b);d.innerHTML='<div class="mui-pull-top-wrapper"><div class="mui-pull-top-canvas"><canvas id="pullDownTips" width="'+c.options.down.tips.size+'" height="'+c.options.down.tips.size+'"></canvas></div></div>';d.addEventListener("webkitTransitionEnd",c);document.body.appendChild(d)}c.pullDownCanvas=document.getElementById("pullDownTips");c.pullDownCanvasCtx=c.pullDownCanvas.getContext("2d");c.canvasUtils.init(c.pullDownCanvas,c.options.down.tips);return d}())}},removePullDownTips:function(){this._super();this.canvasUtils.stopSpin()},pulling:function(e){var f=Math.min(e/(this.options.down.height*1.5),1);var g=Math.min(1,f*2);this.pullDownTips.style.webkitTransform="translate3d(0,"+(e<0?0:e)+"px,0)";this.pullDownCanvas.style.opacity=g;this.pullDownCanvas.style.webkitTransform="rotate("+300*f+"deg)";var c=this.pullDownCanvas;var d=this.pullDownCanvasCtx;var h=this.options.down.tips.size;d.lineWidth=this.options.down.tips.lineWidth;d.fillStyle="#"+this.options.down.tips.color;d.strokeStyle="#"+this.options.down.tips.color;d.stroke();d.clearRect(0,0,h,h);c.style.display="none";c.offsetHeight;c.style.display="inherit";this.canvasUtils.drawArcedArrow(d,h/2+0.5,h/2,h/4,0*Math.PI,5/3*Math.PI*g,false,1,2,0.7853981633974483,25,this.options.down.tips.lineWidth,this.options.down.tips.lineWidth)},beforeChangeOffset:function(c){},afterChangeOffset:function(c){},dragEndAfterChangeOffset:function(c){if(c){this.canvasUtils.startSpin();this.pullDownLoading()}else{this.canvasUtils.stopSpin();this.endPullDownToRefresh()}},canvasUtils:(function(){var d=null,f=null,u=200,p=15,C=0,y=0,m=0,D=0,r=0,c=0,n=0,A=180,s=Math.PI/180,j=1000,B=1000*2.5,e=["35ad0e","d8ad44","d00324","dc00b8","017efc"],t=null;function l(F,G,E,H){return E*F/H+G}function k(F,G,E,H){if((F/=H/2)<1){return E/2*F*F+G}return -E/2*((--F)*(F-2)-1)+G}function q(I,G,H){var F=Math.min(G,H);var E=Math.max(G,H);if(I<F){return F}if(I>E){return F}return I}var i=function(L,T,Y,U,Z,V,aa,R){if(typeof(T)=="string"){T=parseInt(T)}if(typeof(Y)=="string"){Y=parseInt(Y)}if(typeof(U)=="string"){U=parseInt(U)}if(typeof(Z)=="string"){Z=parseInt(Z)}if(typeof(V)=="string"){V=parseInt(V)}if(typeof(aa)=="string"){aa=parseInt(aa)}var P=3;var S=2*Math.PI;L.save();L.beginPath();L.moveTo(T,Y);L.lineTo(U,Z);L.lineTo(V,aa);switch(R){case 0:var E=Math.sqrt(((V-T)*(V-T))+((aa-Y)*(aa-Y)));L.arcTo(U,Z,T,Y,0.55*E);L.fill();break;case 1:L.beginPath();L.moveTo(T,Y);L.lineTo(U,Z);L.lineTo(V,aa);L.lineTo(T,Y);L.fill();break;case 2:L.stroke();break;case 3:var J=(T+U+V)/3;var K=(Y+Z+aa)/3;L.quadraticCurveTo(J,K,T,Y);L.fill();break;case 4:var F,G,H,I,E;var Q=5;if(V==T){E=aa-Y;F=(U+T)/2;H=(U+T)/2;G=Z+E/Q;I=Z-E/Q}else{E=Math.sqrt(((V-T)*(V-T))+((aa-Y)*(aa-Y)));var W=(T+V)/2;var ab=(Y+aa)/2;var X=(W+U)/2;var ac=(ab+Z)/2;var O=(aa-Y)/(V-T);var M=(E/(2*Math.sqrt(O*O+1)))/Q;var N=O*M;F=X-M;G=ac-N;H=X+M;I=ac+N}L.bezierCurveTo(F,G,H,I,T,Y);L.fill();break}L.restore()};var g=function(G,U,V,O,P,K,F,Q,T,E,H,N,M){Q=typeof(Q)!="undefined"?Q:3;T=typeof(T)!="undefined"?T:1;E=typeof(E)!="undefined"?E:Math.PI/8;N=N||1;M=M||10;H=typeof(H)!="undefined"?H:10;G.save();G.lineWidth=N;G.beginPath();G.arc(U,V,O,P,K,F);G.stroke();var R,S,L,I,J;if(T&1){R=Math.cos(P)*O+U;S=Math.sin(P)*O+V;L=Math.atan2(U-R,S-V);if(F){I=R+10*Math.cos(L);J=S+10*Math.sin(L)}else{I=R-10*Math.cos(L);J=S-10*Math.sin(L)}h(G,R,S,I,J,Q,2,E,H)}if(T&2){R=Math.cos(K)*O+U;S=Math.sin(K)*O+V;L=Math.atan2(U-R,S-V);if(F){I=R-10*Math.cos(L);J=S-10*Math.sin(L)}else{I=R+10*Math.cos(L);J=S+10*Math.sin(L)}h(G,R-M*Math.sin(K),S+M*Math.cos(K),I-M*Math.sin(K),J+M*Math.cos(K),Q,2,E,H)}G.restore()};var h=function(J,Y,aa,Z,ab,R,X,E,K){if(typeof(Y)=="string"){Y=parseInt(Y)}if(typeof(aa)=="string"){aa=parseInt(aa)}if(typeof(Z)=="string"){Z=parseInt(Z)}if(typeof(ab)=="string"){ab=parseInt(ab)}R=typeof(R)!="undefined"?R:3;X=typeof(X)!="undefined"?X:1;E=typeof(E)!="undefined"?E:Math.PI/8;K=typeof(K)!="undefined"?K:10;var S=typeof(R)!="function"?i:R;var L=Math.sqrt((Z-Y)*(Z-Y)+(ab-aa)*(ab-aa));var Q=(L-K/3)/L;var V,W,M,N;if(X&1){V=Math.round(Y+(Z-Y)*Q);W=Math.round(aa+(ab-aa)*Q)}else{V=Z;W=ab}if(X&2){M=Y+(Z-Y)*(1-Q);N=aa+(ab-aa)*(1-Q)}else{M=Y;N=aa}J.beginPath();J.moveTo(M,N);J.lineTo(V,W);J.stroke();var P=Math.atan2(ab-aa,Z-Y);var O=Math.abs(K/Math.cos(E));if(X&1){var F=P+Math.PI+E;var T=Z+Math.cos(F)*O;var U=ab+Math.sin(F)*O;var G=P+Math.PI-E;var H=Z+Math.cos(G)*O;var I=ab+Math.sin(G)*O;S(J,T,U,Z,ab,H,I,R)}if(X&2){var F=P+E;var T=Y+Math.cos(F)*O;var U=aa+Math.sin(F)*O;var G=P-E;var H=Y+Math.cos(G)*O;var I=aa+Math.sin(G)*O;S(J,T,U,Y,aa,H,I,R)}};var w=function(H,L){var K=H%L;if(K<r){e.push(e.shift())}var F=e[0],G=e[1],J=q(l(K,F.r,G.r-F.r,L),F.r,G.r),I=q(l(K,F.g,G.g-F.g,L),F.g,G.g),E=q(l(K,F.b,G.b-F.b,L),F.b,G.b);r=K;return"rgb("+parseInt(J)+","+parseInt(I)+","+parseInt(E)+")"};var v=function(E){var F=E||(new Date).getTime();if(!y){y=F}C=F-y;c=k((C+B/2)%B,0,j,B);n=l((C+c)%j,0,360,j);A=20+Math.abs(l((C+B/2)%B,-300,600,B));f.lineWidth=p;f.lineCap="round";f.strokeStyle=w(C,j);f.clearRect(0,0,u,u);d.style.display="none";d.offsetHeight;d.style.display="inherit";f.beginPath();f.arc(u/2,u/2,u/4,parseInt(n-A)%360*s,parseInt(n)%360*s,false);f.stroke();t=requestAnimationFrame(v)};var x=function(){y=0;r=0;t=requestAnimationFrame(v)};var z=function(){t&&cancelAnimationFrame(t)};var o=function(E,F){d=E;f=d.getContext("2d");var F=a.extend(true,{},F);e=F.colors;j=F.duration;B=F.tail_duration;u=F.size;p=F.lineWidth};return{init:o,drawArcedArrow:g,startSpin:x,stopSpin:z}})()})})(mui);