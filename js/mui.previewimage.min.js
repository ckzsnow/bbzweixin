var invoiceList={};(function(a,k){var j='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>';var f='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>';var b="__DEFAULT";var c=document.createElement("div");var d=0;var e=false;var g=function(l){if(l){e=l.isUpload}this.options=a.extend(true,{id:"__MUI_PREVIEWIMAGE",zoom:true,header:e?'<span class="mui-preview-indicator mui-pull-left" style="margin:10px 10px;"></span><span id="closeImgPre" class="mui-icon mui-icon-close mui-pull-right" style="color:white;margin:10px 10px;font-size:30px;"></span><span id="trashImage" class="mui-icon mui-icon-trash mui-pull-right" style="color:white;margin:10px 10px;font-size:30px;"></span>':'<span class="mui-preview-indicator mui-pull-left" style="margin:10px 10px;"></span><span id="closeImgPre" class="mui-icon mui-icon-close mui-pull-right" style="color:white;margin:10px 10px;font-size:30px;"></span>',footer:""},l||{});this.init();this.initEvent()};var i=g.prototype;i.init=function(){var m=this.options;var l=document.getElementById(this.options.id);if(l){document.body.removeChild(l)}c.innerHTML=j.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",m.header).replace("{{footer}}",m.footer);document.body.appendChild(c.firstElementChild);l=document.getElementById(this.options.id);this.element=l;this.scroller=this.element.querySelector(a.classSelector(".slider-group"));this.indicator=this.element.querySelector(a.classSelector(".preview-indicator"));this.loader=this.element.querySelector(a.classSelector(".preview-loading"));if(m.footer){this.element.querySelector(a.classSelector(".preview-footer")).classList.remove(a.className("hidden"))}this.addImages()};i.initEvent=function(){var n=this;a(document.body).on("tap","img[data-preview-src]",function(){if(n.isAnimationing()){return false}n.open(this);return false});if(e){document.getElementById("trashImage").addEventListener("tap",function(o){var r=document.getElementById("fapiaoluru_image").childNodes;var q=n.element.querySelector(".mui-active img");for(var p=0;p<r.length;p++){if(r[p].src==q.src){mui.createConfirmDialog("您确定要删除当前发票图像吗？",function(){n.close()},function(){document.getElementById("fapiaoluru_image").removeChild(r[p]);for(var s in invoiceList){if(s==q.src){delete invoiceList[s];break}}n.close()}).show();break}}},false)}document.getElementById("closeImgPre").addEventListener("tap",function(o){n.close()},false);var l=null;var m=function(){!l&&(l=a.later(function(){n.isInAnimation=true;n.loader.removeEventListener("tap",m);n.scroller.removeEventListener("tap",m);n.close()},300))};this.scroller.addEventListener("doubletap",function(){if(l){l.cancel();l=null}});this.element.addEventListener("webkitAnimationEnd",function(){if(n.element.classList.contains(a.className("preview-out"))){n.element.style.display="none";n.element.classList.remove(a.className("preview-out"));l=null}else{n.loader.addEventListener("tap",m);n.scroller.addEventListener("tap",m)}n.isInAnimation=false});this.element.addEventListener("slide",function(o){if(n.options.zoom){var p=n.element.querySelector(".mui-zoom-wrapper:nth-child("+(n.lastIndex+1)+")");if(p){a(p).zoom().setZoom(1)}}var q=o.detail.slideNumber;n.lastIndex=q;n.indicator&&(n.indicator.innerText=(q+1)+"/"+n.currentGroup.length);n._loadItem(q)})};i.isAnimationing=function(){if(this.isInAnimation){return true}this.isInAnimation=true;return false};i.addImages=function(l,o){this.groups={};var n=[];if(l){if(l===b){n=document.querySelectorAll("img[data-preview-src]:not([data-preview-group])")}else{n=document.querySelectorAll("img[data-preview-src][data-preview-group='"+l+"']")}}else{n=document.querySelectorAll("img[data-preview-src]")}if(n.length){for(var m=0,p=n.length;m<p;m++){this.addImage(n[m])}}};i.addImage=function(m){var l=m.getAttribute("data-preview-group");l=l||b;if(!this.groups[l]){this.groups[l]=[]}var p=m.getAttribute("src");if(m.__mui_img_data&&m.__mui_img_data.src===p){this.groups[l].push(m.__mui_img_data)}else{var o=m.getAttribute("data-preview-src");if(!o){o=p}var n={src:p,lazyload:p===o?"":o,loaded:p===o?true:false,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:m};this.groups[l].push(n);m.__mui_img_data=n}};i.empty=function(){this.scroller.innerHTML=""};i._initImgData=function(n,m){if(!n.sWidth){var l=n.el;n.sWidth=l.offsetWidth;n.sHeight=l.offsetHeight;var o=a.offset(l);n.sTop=o.top;n.sLeft=o.left;n.sScale=Math.max(n.sWidth/k.innerWidth,n.sHeight/k.innerHeight)}m.style.webkitTransform="translate3d(0,0,0) scale("+n.sScale+")"};i._getScale=function(l,p){var n=l.width/p.width;var o=l.height/p.height;var m=1;if(n<=o){m=l.height/(p.height*n)}else{m=l.width/(p.width*o)}return m};i._imgTransitionEnd=function(l){var m=l.target;m.classList.remove(a.className("transitioning"));m.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))};i._loadItem=function(m,n){var p=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(m+1)+")"));var o=this.currentGroup[m];var l=p.querySelector("img");this._initImgData(o,l);if(n){var q=this._getPosition(o);l.style.webkitTransitionDuration="0ms";l.style.webkitTransform="translate3d("+q.x+"px,"+q.y+"px,0) scale("+o.sScale+")";l.offsetHeight}if(!o.loaded&&l.getAttribute("data-preview-lazyload")){var r=this;r.loader.classList.add(a.className("active"));l.style.webkitTransitionDuration="0.5s";l.addEventListener("webkitTransitionEnd",r._imgTransitionEnd.bind(r));l.style.webkitTransform="translate3d(0,0,0) scale("+o.sScale+")";this.loadImage(l,function(){o.loaded=true;l.src=o.lazyload;r._initZoom(p,this.width,this.height);l.classList.add(a.className("transitioning"));l.addEventListener("webkitTransitionEnd",r._imgTransitionEnd.bind(r));l.setAttribute("style","");l.offsetHeight;r.loader.classList.remove(a.className("active"))})}else{o.lazyload&&(l.src=o.lazyload);this._initZoom(p,l.width,l.height);l.classList.add(a.className("transitioning"));l.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this));l.setAttribute("style","");l.offsetHeight}this._preloadItem(m+1);this._preloadItem(m-1)};i._preloadItem=function(m){var o=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(m+1)+")"));if(o){var n=this.currentGroup[m];if(!n.sWidth){var l=o.querySelector("img");this._initImgData(n,l)}}};i._initZoom=function(q,p,o){if(!this.options.zoom){return}if(q.getAttribute("data-zoomer")){return}var n=q.querySelector(a.classSelector(".zoom"));if(n.tagName==="IMG"){var m=this;var l=m._getScale({width:q.offsetWidth,height:q.offsetHeight},{width:p,height:o});a(q).zoom({maxZoom:Math.max(l,1)})}else{a(q).zoom()}};i.loadImage=function(n,l){var o=function(){l&&l.call(this)};var m=new Image();m.onload=o;m.onerror=o;m.src=n.getAttribute("data-preview-lazyload")};i.getRangeByIndex=function(l,m){return{from:0,to:m-1}};i._getPosition=function(l){var n=l.sLeft-k.pageXOffset;var o=l.sTop-k.pageYOffset;var m=(k.innerWidth-l.sWidth)/2;var p=(k.innerHeight-l.sHeight)/2;return{left:n,top:o,x:n-m,y:o-p}};i.refresh=function(r,p){this.currentGroup=p;var v=p.length;var t=[];var n=this.getRangeByIndex(r,v);var o=n.from;var x=n.to+1;var m=r;var l="";var u="";var z=k.innerWidth;var y=k.innerHeight;for(var q=0;o<x;o++,q++){var s=p[o];var w="";if(s.sWidth){w="-webkit-transform:translate3d(0,0,0) scale("+s.sScale+");transform:translate3d(0,0,0) scale("+s.sScale+")"}u=f.replace("{{src}}",s.src).replace("{{lazyload}}",s.lazyload).replace("{{style}}",w);if(o===r){m=q;l=a.className("active")}else{l=""}t.push(u.replace("{{className}}",l))}this.scroller.innerHTML=t.join("");this.element.style.display="block";this.element.classList.add(a.className("preview-in"));this.lastIndex=m;this.element.offsetHeight;a(this.element).slider().gotoItem(m,0);this.indicator&&(this.indicator.innerText=(m+1)+"/"+this.currentGroup.length);this._loadItem(m,true)};i.openByGroup=function(m,l){m=Math.min(Math.max(0,m),this.groups[l].length-1);this.refresh(m,this.groups[l])};i.open=function(m,l){if(this.element.classList.contains(a.className("preview-in"))){return}if(typeof m==="number"){l=l||b;this.addImages(l,m);this.openByGroup(m,l)}else{l=m.getAttribute("data-preview-group");l=l||b;this.addImages(l,m);this.openByGroup(this.groups[l].indexOf(m.__mui_img_data),l)}};i.close=function(o,l){this.element.classList.remove(a.className("preview-in"));this.element.classList.add(a.className("preview-out"));var q=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")"));var n=q.querySelector("img");if(n){n.classList.add(a.className("transitioning"));var p=this.currentGroup[this.lastIndex];var s=this._getPosition(p);var t=s.left;var u=s.top;if(u>k.innerHeight||t>k.innerWidth||u<0||t<0){n.style.opacity=0;n.style.webkitTransitionDuration="0.5s";n.style.webkitTransform="scale("+p.sScale+")"}else{if(this.options.zoom){a(n.parentNode.parentNode).zoom().toggleZoom(0)}n.style.webkitTransitionDuration="0.5s";n.style.webkitTransform="translate3d("+s.x+"px,"+s.y+"px,0) scale("+p.sScale+")"}}var v=this.element.querySelectorAll(a.classSelector(".zoom-wrapper"));for(var m=0,r=v.length;m<r;m++){a(v[m]).zoom().destory()}};i.isShown=function(){return this.element.classList.contains(a.className("preview-in"))};var h=null;a.previewImage=function(l){if(!h){h=new g(l)}return h};a.getPreviewImage=function(){return h};a.initPreviewImage=function(){h=null}})(mui,window);