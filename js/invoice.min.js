Date.prototype.Format=function(a){var b=a;var c=["日","一","二","三","四","五","六"];b=b.replace(/yyyy|YYYY/,this.getFullYear());b=b.replace(/yy|YY/,(this.getYear()%100)>9?(this.getYear()%100).toString():"0"+(this.getYear()%100));b=b.replace(/MM/,(this.getMonth()+1)>9?(this.getMonth()+1).toString():"0"+(this.getMonth()+1));b=b.replace(/M/g,this.getMonth());b=b.replace(/w|W/g,c[this.getDay()]);b=b.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate());b=b.replace(/d|D/g,this.getDate());b=b.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours());b=b.replace(/h|H/g,this.getHours());b=b.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes());b=b.replace(/m/g,this.getMinutes());b=b.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds());b=b.replace(/s|S/g,this.getSeconds());return b};mui.createUploadMask=function(a){var b=document.createElement("div");b.classList.add("upload-file");b.innerHTML="<meter id='upLoadProgress' style='width:80%;margin:50% 10%;' value='50' max='100'></meter>";b.addEventListener("touchmove",mui.preventDefault);b.addEventListener("tap",function(){c.close()});var c=[b];c._show=false;c.show=function(){c._show=true;b.setAttribute("style","opacity:1");document.body.appendChild(b);return c};c._remove=function(){if(c._show){c._show=false;b.setAttribute("style","opacity:0");mui.later(function(){var d=document.body;b.parentNode===d&&d.removeChild(b)},350)}return c};c.close=function(){if(a){if(a()!==false){c._remove()}}else{c._remove()}};return c};mui.createTipDialog=function(c,a){var e="<div style='width:80%;margin:50% 10%;border:1px solid #ddd;background-color: white;border-radius: 5px;'><div style='margin-top:20px;margin-left:20px;'>提示信息</div><hr/><div style='margin-top:20px;margin-left:20px;margin-bottom:20px;margin-right:20px;height:60px;'>{{info}}</div></div>";var b=document.createElement("div");b.classList.add("dialog");b.innerHTML=e.replace("{{info}}",c);b.addEventListener("touchmove",mui.preventDefault);b.addEventListener("tap",function(){d.close()});var d=[b];d._show=false;d.show=function(){d._show=true;b.setAttribute("style","opacity:1");document.body.appendChild(b);return d};d._remove=function(){if(d._show){d._show=false;b.setAttribute("style","opacity:0");mui.later(function(){var f=document.body;b.parentNode===f&&f.removeChild(b)},350)}return d};d.close=function(){if(a){a()}d._remove()};return d};mui.createConfirmDialog=function(d,b,a){var f="<div style='width:80%;margin:50% 10%;border:1px solid #ddd;background-color: white;border-radius: 5px;'><div style='margin-top:20px;margin-left:20px;'>提示信息</div><hr/><div style='margin-top:20px;margin-left:20px;margin-bottom:20px;margin-right:20px;height:60px;'>{{info}}</div><div style='text-align:right;margin-bottom:20px;margin-right:20px;'><a id='createConfirmDialog_cancel' href='javascript:void(0);' style='margin-right:20px;text-decoration:none;'>取消</a><a id='createConfirmDialog_accept' href='javascript:void(0);' style='text-decoration:none;'>确定</a></div></div>";var c=document.createElement("div");c.classList.add("dialog");c.innerHTML=f.replace("{{info}}",d);c.addEventListener("touchmove",mui.preventDefault);var e=[c];e._show=false;e.show=function(){e._show=true;c.setAttribute("style","opacity:1");document.body.appendChild(c);document.getElementById("createConfirmDialog_cancel").addEventListener("tap",function(){if(b){b()}e.close()});document.getElementById("createConfirmDialog_accept").addEventListener("tap",function(){if(a){a()}e.close()});return e};e._remove=function(){if(e._show){e._show=false;c.setAttribute("style","opacity:0");mui.later(function(){var g=document.body;c.parentNode===g&&g.removeChild(c)},350)}return e};e.close=function(){e._remove()};return e};var invoiceTypePicker=new mui.PopPicker();invoiceTypePicker.setData([{value:"ywj",text:"董事长 叶文洁"},{value:"aaa",text:"总经理 艾AA"}]);mui.init();var viewApi=mui("#app").view({defaultPage:"#mainpage"});mui(".mui-scroll-wrapper").scroll();var view=viewApi.view;var oldBack=mui.back;mui.back=function(){if(viewApi.canBack()){viewApi.back()}else{oldBack()}};document.getElementById("piaojuluru_main_menu").addEventListener("tap",function(){mui.initPreviewImage();mui.previewImage({isUpload:true})});document.getElementById("fapiaoshenhe_main_menu").addEventListener("tap",function(){mui.initPreviewImage();mui.previewImage({isUpload:false})});document.getElementById("shenhezhongfapiao_main_menu").addEventListener("tap",function(){});document.getElementById("yishenhefapiao_main_menu").addEventListener("tap",function(){});document.getElementById("quanbufapiao_main_menu").addEventListener("tap",function(){});document.getElementById("fapiaosaixuan_main_menu").addEventListener("tap",function(){});function getImageDataURL(d){var a=document.createElement("canvas");a.width=d.width;a.height=d.height;var b=a.getContext("2d");b.drawImage(d,0,0);var c=a.toDataURL("image/png");return c}var imgURL;document.getElementById("sliderSegmentedControl").style.width=document.body.offsetWidth-100+"px";document.getElementById("fapiaoluru_addInvoiceImage").onchange=function(b){var g=document.getElementById("fapiaoluru_image");if(g.innerHTML.indexOf("img")==-1){g.innerHTML=""}var h=document.createElement("img");h.style.marginLeft="5px";h.style.borderRadius="5px";h.style.width="70px";h.style.height="70px";h.setAttribute("data-preview-group","1");h.setAttribute("data-preview-src","");g.appendChild(h);var f=b.target.files,c;if(f&&f.length>0){c=f[0];try{var i=window.URL||window.webkitURL;imgURL=i.createObjectURL(c);h.src=imgURL;invoiceList[imgURL]=document.getElementById("fapiaoluru_addInvoiceImage").files[0]}catch(a){try{var d=new FileReader();d.onload=function(e){h.src=e.target.result;invoiceList[h.src]=document.getElementById("fapiaoluru_addInvoiceImage").files[0]};d.readAsDataURL(c)}catch(a){alert("Neither createObjectURL or FileReader are supported")}}}};document.getElementById("fapiaoluru_amount_input_sub").onchange=function(a){document.getElementById("fapiaoluru_amount").innerHTML=a.target.value.replace(/\b(0+)/gi,"")};var currentDate=new Date();var currentInvoiceTypeId;currentDate=currentDate.Format("yyyy-MM-DD");document.getElementById("fapiaoluru_date").innerText=currentDate;var options={type:"date",value:currentDate};var datePicker=new mui.DtPicker(options);document.getElementById("fapiaoluru_date_li").addEventListener("tap",function(){datePicker.show(function(a){document.getElementById("fapiaoluru_date").innerText=a.text})},false);document.getElementById("fapiaoluru_type_li").addEventListener("tap",function(a){invoiceTypePicker.show(function(b){document.getElementById("fapiaoluru_type").innerText=b[0].text;currentInvoiceTypeId=b[0].value})},false);document.getElementById("fapiaoluru_submit").addEventListener("tap",function(a){var e=document.getElementById("fapiaoluru_amount").innerText;var g=document.getElementById("fapiaoluru_type").innerText;var f=document.getElementById("fapiaoluru_date").innerText;var h=true;for(var i in invoiceList){h=false;break}if(h){mui.createTipDialog("您还没有添加发票图像!",null).show();return}if(isNaN(e)||e<=0){mui.createTipDialog("您还没有输入发票金额!",null).show();return}if(g=="选择发票类型"){mui.createTipDialog("您还没有选择发票类型!",null).show();您还没有输入发票金额;return}var j=mui.createUploadMask(false);j.show();var d={};var k=new XMLHttpRequest();var b=new FormData();for(var i in d){b.append(i,d[i])}var c=0;for(var i in invoiceList){b.append("file"+c,invoiceList[i]);c++}k.upload.addEventListener("progress",function(l){if(l.lengthComputable){var m=Math.round(l.loaded*100/l.total)*100;document.getElementById("upLoadProgress").value=m}},false);k.addEventListener("load",function(l){var o=l.target.responseText;if(o.error_code=="0"){mui.createTipDialog("发票提交成功!",null).show();invoiceList={};document.getElementById("fapiaoluru_amount").innerText="0";document.getElementById("fapiaoluru_type").innerText="选择发票类型";document.getElementById("fapiaoluru_date").innerText=currentDate;var n=document.getElementById("fapiaoluru_image").childNodes;for(var m=0;m<n.length;m++){document.getElementById("fapiaoluru_image").removeChild(n[m])}document.getElementById("fapiaoluru_image").innerHTML='<p style="margin-top: -5px;margin-left: 10px;">票据图像</p>'}else{mui.createTipDialog("发票提交失败!，请稍后重试",null).show()}j.close()},false);k.addEventListener("error",function(l){mui.createTipDialog("发票提交失败!，请稍后重试",null).show();j.close()},false);k.addEventListener("abort",null,false);k.open("POST","http://139.196.23.131:8080/user/uploadifyTest_doUpload");k.send(b)},false);var deceleration=mui.os.ios?0.003:0.0009;mui(".mui-scroll-wrapper").scroll({bounce:false,indicators:true,deceleration:deceleration});mui(mui("#fapiaoshenhe_pullrefresh")[0]).pullToRefresh({down:{callback:function(){var a=this;setTimeout(function(){a.endPullDownToRefresh()},2000)}}});mui("#OA_task_2").on("slideleft",".mui-table-view-cell",function(c){var b=this;var a=mui.createConfirmDialog("您确定要删除吗？",function(){a.close();setTimeout(function(){mui.swipeoutClose(b)},0)},function(){a.close();b.parentNode.removeChild(b)});a.show()});mui("#OA_task_2").on("slideright",".mui-table-view-cell",function(c){var b=this;var a=mui.createConfirmDialog("您确定要删除吗？",function(){a.close();setTimeout(function(){mui.swipeoutClose(b)},0)},function(){a.close();b.parentNode.removeChild(b)});a.show()});var fapiaoshaixuan_end_date=new Date();var fapiaoshaixuan_invoice_type_id;fapiaoshaixuan_end_date=fapiaoshaixuan_end_date.Format("yyyy-MM-DD");var fapiaoshaixuan_start_date=fapiaoshaixuan_end_date.substr(0,fapiaoshaixuan_end_date.lastIndexOf("-"))+"-01";document.getElementById("fapiaosaixuan_start_date").innerText=fapiaoshaixuan_start_date;document.getElementById("fapiaosaixuan_end_date").innerText=fapiaoshaixuan_end_date;document.getElementById("fapiaoluru_date").innerText=currentDate;var fapiaosaixuan_start_options={type:"date",value:fapiaoshaixuan_start_date};var fapiaosaixuan_end_options={type:"date",value:fapiaoshaixuan_end_date};var fapiaoshaixuan_start_date_picker=new mui.DtPicker(fapiaosaixuan_start_options);var fapiaoshaixuan_end_date_picker=new mui.DtPicker(fapiaosaixuan_end_options);document.getElementById("fapiaosaixuan_start_date_click").addEventListener("tap",function(){fapiaoshaixuan_start_date_picker.show(function(a){document.getElementById("fapiaosaixuan_start_date").innerText=a.text})},false);document.getElementById("fapiaosaixuan_end_date_click").addEventListener("tap",function(){fapiaoshaixuan_end_date_picker.show(function(a){document.getElementById("fapiaosaixuan_end_date").innerText=a.text})},false);document.getElementById("fapiaosaixuan_type_click").addEventListener("tap",function(a){invoiceTypePicker.show(function(b){document.getElementById("fapiaosaixuan_type").innerText=b[0].text;fapiaoshaixuan_invoice_type_id=b[0].value})},false);document.getElementById("fapiaosaixuan_search_click").addEventListener("tap",function(a){mui.createTipDialog("未完成!",null).show()},false);