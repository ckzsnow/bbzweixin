(function(a,i){var b=a.className("zoom");var c=a.className("zoom-scroller");var g="."+b;var h="."+c;var f="pinchstart";var d="pinch";var e="pinchend";if("ongesturestart" in i){f="gesturestart";d="gesturechange";e="gestureend"}a.Zoom=function(k,B){var K=this;K.options=a.extend(a.Zoom.defaults,B);K.wrapper=K.element=k;K.scroller=k.querySelector(h);K.scrollerStyle=K.scroller&&K.scroller.style;K.zoomer=k.querySelector(g);K.zoomerStyle=K.zoomer&&K.zoomer.style;K.init=function(){a.options.gestureConfig.pinch=true;a.options.gestureConfig.doubletap=true;K.initEvents()};K.initEvents=function(M){var L=M?"removeEventListener":"addEventListener";var N=K.scroller;N[L](f,K.onPinchstart);N[L](d,K.onPinch);N[L](e,K.onPinchend);N[L]("touchstart",K.onTouchstart);N[L]("touchmove",K.onTouchMove);N[L]("touchcancel",K.onTouchEnd);N[L]("touchend",K.onTouchEnd);N[L]("drag",function(O){if(o||z){O.stopPropagation()}});N[L]("doubletap",function(O){K.toggleZoom(O.detail.center)})};K.transition=function(L,M){M=M||0;L.webkitTransitionDuration=M+"ms";return K};K.translate=function(L,M,N){M=M||0;N=N||0;L.webkitTransform="translate3d("+M+"px,"+N+"px,0px)";return K};K.scale=function(M,L){L=L||1;M.webkitTransform="translate3d(0,0,0) scale("+L+")";return K};K.scrollerTransition=function(L){return K.transition(K.scrollerStyle,L)};K.scrollerTransform=function(L,M){return K.translate(K.scrollerStyle,L,M)};K.zoomerTransition=function(L){return K.transition(K.zoomerStyle,L)};K.zoomerTransform=function(L){return K.scale(K.zoomerStyle,L)};var C=1,j=1,A=false,z=false;K.onPinchstart=function(L){z=true};K.onPinch=function(L){if(!A){K.zoomerTransition(0);A=true}C=(L.detail?L.detail.scale:L.scale)*j;if(C>K.options.maxZoom){C=K.options.maxZoom-1+Math.pow((C-K.options.maxZoom+1),0.5)}if(C<K.options.minZoom){C=K.options.minZoom+1-Math.pow((K.options.minZoom-C+1),0.5)}K.zoomerTransform(C)};K.onPinchend=function(L){C=Math.max(Math.min(C,K.options.maxZoom),K.options.minZoom);K.zoomerTransition(K.options.speed).zoomerTransform(C);j=C;A=false};K.setZoom=function(L){C=j=L;K.scrollerTransition(K.options.speed).scrollerTransform(0,0);K.zoomerTransition(K.options.speed).zoomerTransform(C)};K.toggleZoom=function(P,Q){if(typeof P==="number"){Q=P;P=undefined}Q=typeof Q==="undefined"?K.options.speed:Q;if(C&&C!==1){C=j=1;K.scrollerTransition(Q).scrollerTransform(0,0)}else{C=j=K.options.maxZoom;if(P){var M=a.offset(K.zoomer);var R=M.top;var L=M.left;var N=(P.x-L)*C;var O=(P.y-R)*C;this._cal();if(N>=q&&N<=(q+J)){N=q-N+J/2}else{if(N<q){N=q-N+J/2}else{if(N>(q+J)){N=q+J-N-J/2}}}if(O>=r&&O<=(r+I)){O=r-O+I/2}else{if(O<r){O=r-O+I/2}else{if(O>(r+I)){O=r+I-O-I/2}}}N=Math.min(Math.max(N,s),q);O=Math.min(Math.max(O,t),r);K.scrollerTransition(Q).scrollerTransform(N,O)}else{K.scrollerTransition(Q).scrollerTransform(0,0)}}K.zoomerTransition(Q).zoomerTransform(C)};K._cal=function(){J=K.wrapper.offsetWidth;I=K.wrapper.offsetHeight;y=K.zoomer.offsetWidth;n=K.zoomer.offsetHeight;var M=y*C;var L=n*C;s=Math.min((J/2-M/2),0);q=-s;t=Math.min((I/2-L/2),0);r=-t};var J,I,p,o,l,m,s,t,q,r,y,n,x={},w={},u,v,D,F,G,E,H;K.onTouchstart=function(L){L.preventDefault();p=true;x.x=L.type==="touchstart"?L.targetTouches[0].pageX:L.pageX;x.y=L.type==="touchstart"?L.targetTouches[0].pageY:L.pageY};K.onTouchMove=function(L){L.preventDefault();if(!p){return}if(!o){J=K.wrapper.offsetWidth;I=K.wrapper.offsetHeight;y=K.zoomer.offsetWidth;n=K.zoomer.offsetHeight;var O=a.parseTranslateMatrix(a.getStyles(K.scroller,"webkitTransform"));u=O.x||0;v=O.y||0;K.scrollerTransition(0)}var N=y*C;var M=n*C;if(N<J&&M<I){return}s=Math.min((J/2-N/2),0);q=-s;t=Math.min((I/2-M/2),0);r=-t;w.x=L.type==="touchmove"?L.targetTouches[0].pageX:L.pageX;w.y=L.type==="touchmove"?L.targetTouches[0].pageY:L.pageY;if(!o&&!A){if((Math.floor(s)===Math.floor(u)&&w.x<x.x)||(Math.floor(q)===Math.floor(u)&&w.x>x.x)){p=false;return}}o=true;l=w.x-x.x+u;m=w.y-x.y+v;if(l<s){l=s+1-Math.pow((s-l+1),0.8)}if(l>q){l=q-1+Math.pow((l-q+1),0.8)}if(m<t){m=t+1-Math.pow((t-m+1),0.8)}if(m>r){m=r-1+Math.pow((m-r+1),0.8)}if(!D){D=w.x}if(!E){E=w.y}if(!F){F=a.now()}G=(w.x-D)/(a.now()-F)/2;H=(w.y-E)/(a.now()-F)/2;if(Math.abs(w.x-D)<2){G=0}if(Math.abs(w.y-E)<2){H=0}D=w.x;E=w.y;F=a.now();K.scrollerTransform(l,m)};K.onTouchEnd=function(L){if(!L.touches.length){z=false}if(!p||!o){p=false;o=false;return}p=false;o=false;var P=300;var Q=300;var M=G*P;var R=l+M;var N=H*Q;var S=m+N;if(G!==0){P=Math.abs((R-l)/G)}if(H!==0){Q=Math.abs((S-m)/H)}var O=Math.max(P,Q);l=R;m=S;var U=y*C;var T=n*C;s=Math.min((J/2-U/2),0);q=-s;t=Math.min((I/2-T/2),0);r=-t;l=Math.max(Math.min(l,q),s);m=Math.max(Math.min(m,r),t);K.scrollerTransition(O).scrollerTransform(l,m)};K.destory=function(){K.initEvents(true);delete a.data[K.wrapper.getAttribute("data-zoomer")];K.wrapper.setAttribute("data-zoomer","")};K.init();return K};a.Zoom.defaults={speed:300,maxZoom:3,minZoom:1,};a.fn.zoom=function(j){var k=[];this.each(function(){var n=null;var m=this;var l=m.getAttribute("data-zoomer");if(!l){l=++a.uuid;a.data[l]=n=new a.Zoom(m,j);m.setAttribute("data-zoomer",l)}else{n=a.data[l]}k.push(n)});return k.length===1?k[0]:k}})(mui,window);